<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting…</title>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWN8TWGZ3Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}

    gtag('js', new Date());

    gtag('config', 'G-QWN8TWGZ3Q', {
      page_title: 'QR Redirect',
      page_location: window.location.href,
      debug_mode: true
    });
  </script>

  <script>
    const params = new URLSearchParams(window.location.search);

    const gp = params.get('gp');
    const village = params.get('village');
    const hamlet = params.get('hamlet');

    const payload = {
      gp,
      village,
      hamlet,
      userAgent: navigator.userAgent,
      referrer: document.referrer
    };

    console.log('[QR] Parameters:', payload);

    /* ---------- GA EVENT ---------- */
    gtag('event', 'qr_scan', {
      gp,
      village,
      hamlet
    });

    console.log('[GA] qr_scan event fired');

    /* ---------- GOOGLE SHEETS LOG ---------- */
    fetch('https://script.google.com/macros/s/AKfycbwRBD_YTAThEBUOYDjwlCWc-gccJrVoTkZNi8cBrMTXFFF821Pl3tdlBHkRn3lQd0yf/exec', {
      method: 'POST',
      mode: 'no-cors',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    })
    .then(() => console.log('[Sheets] Logged successfully'))
    .catch(err => console.error('[Sheets] Logging failed', err));

    /* ---------- REDIRECT ---------- */
    setTimeout(() => {
      console.log('[Redirect] Moving to content');
      window.location.href = 'https://youtu.be/Pmtx3IDo5KI';
    }, 900);
  </script>
</head>
<body>
  Redirecting…
</body>
</html>
